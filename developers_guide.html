<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="API Reference" href="plugin_api.html" /><link rel="prev" title="The Freva command line interface" href="FrevaCli.html" />

    <link rel="shortcut icon" href="_static/logo.png"/><!-- Generated with Sphinx 7.1.0 and Furo 2023.07.26 -->
        <title>Plugin Developer Guide - freva user guide 2307.0.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=362ab14a" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: tomato;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">freva user guide 2307.0.2 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">freva user guide 2307.0.2 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Content:</span></p>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="Freva.html">Freva python module</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Freva python module</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="FrevaCli.html">The Freva command line interface</a></li>
<li class="toctree-l1 current has-children current-page"><a class="current reference internal" href="#">Plugin Developer Guide</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Plugin Developer Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="plugin_api.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">Frequently Ask Questions and best practices</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="whats-new.html">What’s new</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of What’s new</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="plugin-developer-guide">
<h1>Plugin Developer Guide<a class="headerlink" href="#plugin-developer-guide" title="Permalink to this heading">#</a></h1>
<div class="toctree-wrapper compound">
</div>
<p>This documentation helps to get started with creating user defined <code class="docutils literal notranslate"><span class="pre">Freva</span></code>
plugins. This section provides a minimal example to turn your <em>existing</em> data
analysis code into a Freva plugin. Detailed usage information can be found in the
<a class="reference internal" href="plugin_api.html#apireference"><span class="std std-ref">API Reference</span></a>.</p>
<section id="module-evaluation_system.api.plugin">
<span id="a-minimal-example"></span><h2>A Minimal Example<a class="headerlink" href="#module-evaluation_system.api.plugin" title="Permalink to this heading">#</a></h2>
<p>Definition of the base class that is used to implement user plugins.</p>
<p>The plugin API (Application Program Interface) is the central connection
of a user plugin code and the Freva system infrastructure. The API
enables the users to conveniently set up, run, and keep track of applied plugins.
The reference below gives an overview of how to set up user defined plugins.
For this purpose we assume that a plugin core (without Freva) already exists
- for example as a command line interface tool (cli). Once such a cli has been
set up a interface to Freva must be defined. This reference will introduce
the possible definition options below.</p>
<p>Here we assume that the above mentioned cli code is stored in a directory
name <code class="docutils literal notranslate"><span class="pre">/mnt/freva/plugins/new_plugin</span></code> furthermore the actual cli code can be
executed via:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cli/calculate -c 5 -n 6.4 --overwrite --name=Test</span>
</pre></div>
</div>
</div></blockquote>
<p>With help of this API a Freva plugin can be created in <code class="docutils literal notranslate"><span class="pre">/mnt/freva/plugin/new_plugin/plugin.py</span></code></p>
<dl class="py class">
<dt class="sig sig-object py" id="evaluation_system.api.plugin.PluginAbstract">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">evaluation_system.api.plugin.</span></span><span class="sig-name descname"><span class="pre">PluginAbstract</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">user</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">User</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#evaluation_system.api.plugin.PluginAbstract" title="Permalink to this definition">#</a></dt>
<dd><p>Base class that is used as a template for all Freva plugins.
Any api wrapper class defining Freva plugins must inherit from this class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>user</strong> (<em>evaluation_system.model.user.User</em><em>, </em><em>default None</em>) – Pre defined evaluation system user object, if None given (default)
a new instance of a user object for the current user will be created.</p>
</dd>
</dl>
<dl class="simple">
<dt>The following attributes are mandatory and have to be set:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="plugin_api.html#evaluation_system.api.plugin.PluginAbstract.__short_description__" title="evaluation_system.api.plugin.PluginAbstract.__short_description__"><code class="xref py py-class docutils literal notranslate"><span class="pre">__short_description__</span></code></a></p></li>
<li><p><a class="reference internal" href="plugin_api.html#evaluation_system.api.plugin.PluginAbstract.__version__" title="evaluation_system.api.plugin.PluginAbstract.__version__"><code class="xref py py-class docutils literal notranslate"><span class="pre">__version__</span></code></a></p></li>
<li><p><a class="reference internal" href="plugin_api.html#evaluation_system.api.plugin.PluginAbstract.__parameters__" title="evaluation_system.api.plugin.PluginAbstract.__parameters__"><code class="xref py py-class docutils literal notranslate"><span class="pre">__parameters__</span></code></a></p></li>
<li><p><a class="reference internal" href="plugin_api.html#evaluation_system.api.plugin.PluginAbstract.run_tool" title="evaluation_system.api.plugin.PluginAbstract.run_tool"><code class="xref py py-class docutils literal notranslate"><span class="pre">run_tool</span></code></a></p></li>
</ul>
</dd>
<dt>Whereas the following properties can be optionally set:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="plugin_api.html#evaluation_system.api.plugin.PluginAbstract.__long_description__" title="evaluation_system.api.plugin.PluginAbstract.__long_description__"><code class="xref py py-class docutils literal notranslate"><span class="pre">__long_description__</span></code></a></p></li>
<li><p><a class="reference internal" href="plugin_api.html#evaluation_system.api.plugin.PluginAbstract.__tags__" title="evaluation_system.api.plugin.PluginAbstract.__tags__"><code class="xref py py-class docutils literal notranslate"><span class="pre">__tags__</span></code></a></p></li>
<li><p><a class="reference internal" href="plugin_api.html#evaluation_system.api.plugin.PluginAbstract.__category__" title="evaluation_system.api.plugin.PluginAbstract.__category__"><code class="xref py py-class docutils literal notranslate"><span class="pre">__category__</span></code></a></p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<p>In order to configure and call this cli, a Freva wrapper api class will
have the be created in <code class="docutils literal notranslate"><span class="pre">/mnt/freva/plugins/new_plugin/plugin.py</span></code>.
A minimal configuration example would look as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">evaluation_system.api</span> <span class="kn">import</span> <span class="n">plugin</span><span class="p">,</span> <span class="n">parameters</span>
<span class="k">class</span> <span class="nc">MyPlugin</span><span class="p">(</span><span class="n">plugin</span><span class="o">.</span><span class="n">PluginAbstract</span><span class="p">):</span>
    <span class="n">__short_description__</span> <span class="o">=</span> <span class="s2">&quot;Short plugin description&quot;</span>
    <span class="n">__long_description__</span> <span class="o">=</span> <span class="s2">&quot;Optional longer description&quot;</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">__parameters__</span> <span class="o">=</span>  <span class="n">parameters</span><span class="o">.</span><span class="n">ParameterDictionary</span><span class="p">(</span>
                        <span class="n">parameters</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span>
                            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span>
                            <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;This is an optional configurable &quot;</span>
                                  <span class="s2">&quot;int variable named number without &quot;</span>
                                  <span class="s2">&quot;default value and this description&quot;</span><span class="p">)</span>
                        <span class="p">),</span>
                        <span class="n">parameters</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span>
                            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
                            <span class="n">mandatory</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Required float value without default&quot;</span>
                        <span class="p">),</span>
                        <span class="n">parameters</span><span class="o">.</span><span class="n">Bool</span><span class="p">(</span>
                            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span><span class="p">,</span>
                            <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;a boolean parameter &quot;</span>
                                  <span class="s2">&quot;with default value of false&quot;</span><span class="p">)</span>
                        <span class="p">),</span>
                        <span class="n">parameters</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                      <span class="p">)</span>
    <span class="k">def</span> <span class="nf">run_tool</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="o">|</span><span class="nb">int</span><span class="o">|</span><span class="nb">bool</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Definition of the tool the is running the cli.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        config_dict: dict</span>
<span class="sd">            Plugin configuration stored in a dictionary</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">(</span>
            <span class="p">(</span>
              <span class="sa">f</span><span class="s2">&quot;cli/calculate -c </span><span class="si">{</span><span class="n">config_dict</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span>
              <span class="sa">f</span><span class="s2">&quot;-n </span><span class="si">{</span><span class="n">config_dict</span><span class="p">[</span><span class="s1">&#39;number&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> --name=</span><span class="si">{</span><span class="n">config_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MyPlugin was run with&quot;</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The actual configuration is defined by the <a class="reference internal" href="plugin_api.html#evaluation_system.api.plugin.PluginAbstract.__parameters__" title="evaluation_system.api.plugin.PluginAbstract.__parameters__"><code class="xref py py-class docutils literal notranslate"><span class="pre">__parameters__</span></code></a>
property, which is of type
<a class="reference internal" href="plugin_api.html#evaluation_system.api.parameters.ParameterDictionary" title="evaluation_system.api.parameters.ParameterDictionary"><code class="xref py py-class docutils literal notranslate"><span class="pre">evaluation_system.api.parameters.ParameterDictionary</span></code></a>.</p>
</div>
<p>If you need to test it use the <code class="docutils literal notranslate"><span class="pre">EVALUATION_SYSTEM_PLUGINS</span></code> environment
variable to point to the source directory and package.
For example assuming you have the source code in <code class="docutils literal notranslate"><span class="pre">/mnt/freva/plugins</span></code>
and the package holding the class implementing
<a class="reference internal" href="plugin_api.html#module-evaluation_system.api.plugin" title="evaluation_system.api.plugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">evaluation_system.api.plugin</span></code></a> is
<code class="docutils literal notranslate"><span class="pre">my_plugin.plugin</span></code> (i.e. its absolute file path is
<code class="docutils literal notranslate"><span class="pre">/mnt/freva/plugins/my_plugin/plugin_module.py</span></code>), you would tell the system
how to find the plugin by issuing the following command (bash &amp; co):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">EVALUATION_SYSTEM_PLUGINS</span><span class="o">=/</span><span class="n">mnt</span><span class="o">/</span><span class="n">freva</span><span class="o">/</span><span class="n">plugins</span><span class="o">/</span><span class="n">my_plugin</span><span class="p">,</span><span class="n">plugin</span>
</pre></div>
</div>
<p>Use a colon to separate multiple items:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">EVALUATION_SYSTEM_PLUGINS</span><span class="o">=/</span><span class="n">path1</span><span class="p">,</span><span class="n">plugin1</span><span class="p">:</span><span class="o">/</span><span class="n">path2</span><span class="p">,</span><span class="n">plugin2</span><span class="p">:</span><span class="o">/</span><span class="n">path3</span><span class="p">,</span><span class="n">plugin3</span>
</pre></div>
</div>
<p>By telling the system where to find the packages it can find the
<a class="reference internal" href="plugin_api.html#module-evaluation_system.api.plugin" title="evaluation_system.api.plugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">evaluation_system.api.plugin</span></code></a> implementations. The system just
loads the packages and get to the classes using the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">class.__subclasses__()</span></code> method. The reference speaks about
<em>weak references</em> so it’s not clear if (and when) they get removed.
We might have to change this in the future if it’s not enough.
Another approach would be forcing self-registration of a
class in the <span class="xref std std-ref">__metaclass__</span> attribute when the
class is implemented.</p>
</dd></dl>

</section>
<section id="setting-up-your-new-plugin">
<h2>Setting up your new plugin<a class="headerlink" href="#setting-up-your-new-plugin" title="Permalink to this heading">#</a></h2>
<p>This section illustrates the steps that are necessary to turn existing
data analysis code into a Freva plugin.
Like above, we assume that the code is stored in a specific location for example
<code class="docutils literal notranslate"><span class="pre">~/workspace/tracking_tool</span></code>. Also, let’s assume that the analysis tool is written
in the <em>R</em> script language.</p>
<section id="creating-a-new-repository-from-a-template">
<h3>Creating a new repository from a template<a class="headerlink" href="#creating-a-new-repository-from-a-template" title="Permalink to this heading">#</a></h3>
<p>We have created a <a class="reference external" href="https://gitlab.dkrz.de/freva/plugins4freva/plugintemplate/">template repository</a> that helps
you getting started with the Freva plugin development. Therefore we
recommend you to use this repository. Use the following commands to turn this
template repository into your new Freva plugin repository:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">wget https://gitlab.dkrz.de/freva/plugins4freva/plugintemplate/-/archive/main/plugintemplate-main.zip</span>
<span class="go">unzip plugintemplate-main.zip</span>
<span class="go">mv plugintemplate-main freva_tracking</span>
<span class="go">cd freva_tracking</span>
<span class="go">git init --shared .</span>
<span class="go">cp -r ~/workspace/tracking_tool src</span>
<span class="go">git add .</span>
</pre></div>
</div>
<p>You have now created a new Freva plugin repository. It is a good idea to use
some kind of repository server, like gitlab, where you make your code accessible.
Talk to your Freva admins to work out a good location for your code. Once you have agreed
upon a location you should create a new repository on the server side using the
web interface of your repository host system. Once created set
the remote host address on the locally created repository (the one where you did a <cite>git init</cite>):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">git remote set-url origin https://gitlab.com/path/to/the/remote/repo.git</span>
</pre></div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>If you are unfamiliar with git you can find plenty of online resources on
the web. A good resource might be the
<a class="reference external" href="https://git-scm.com/docs/gittutorial">official git tutorial page</a>.</p>
</div>
</section>
<section id="installing-dependencies">
<h3>Installing dependencies<a class="headerlink" href="#installing-dependencies" title="Permalink to this heading">#</a></h3>
<p>Once the git repository has been set up and configured, all dependencies the tool
needs should be installed. Here we assume the analysis tool is based on a gnu-R
stack. Therefore gnu-R and certain libraries have to be part of the plugin
environment. This environment will be created using
<a class="reference external" href="https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html">anaconda</a>.
To find out what dependencies you should be installing query the
<a class="reference external" href="https://anaconda.org/">anaconda search page</a>.
Once you have found all packages that can be installed via anaconda you can add them
to the <code class="docutils literal notranslate"><span class="pre">deployment/plugin-env.yaml</span></code> file. Simply add the entries that are needed
to the existing file.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">channels</span><span class="p">:</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">conda-forge</span>
<span class="w w-Error"> </span><span class="nt">dependencies</span><span class="p">:</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">conda</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">r-base</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">r-essentials</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">r-ncdf4</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">black</span>
</pre></div>
</div>
<p>Probably there are package dependencies that cannot be installed via
anaconda and need to bee installed otherwise. To do so you can use
a simple command line interface in <code class="docutils literal notranslate"><span class="pre">deployment/install_resources.py</span></code>
and add the following command into the <code class="docutils literal notranslate"><span class="pre">build</span></code>
section of the <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> in the repository:</p>
<div class="highlight-Makefile notranslate"><div class="highlight"><pre><span></span><span class="nf">build</span><span class="o">:</span>
<span class="w">    </span>python<span class="w"> </span>deployment/install_resources.py<span class="w"> </span>gnu-r<span class="w"> </span>ncdf4.helpers
</pre></div>
</div>
<p>To get an overview over the full functionality of the installation cli you
can query the help.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">python deployment/install_resources.py --help</span>
</pre></div>
</div>
<p>After everything is setup you can build use the <code class="docutils literal notranslate"><span class="pre">make</span></code> command to deploy the
plugin environment.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">make all</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> will use the <code class="docutils literal notranslate"><span class="pre">conda</span></code> command. If anaconda is not available
by default on your system you can load the Freva environment, which ships
anaconda.</p>
</div>
<p>Afterwards you can refer to the <a class="reference internal" href="plugin_api.html#pluginapi"><span class="std std-ref">Plugin API Reference</span></a> and <a class="reference internal" href="plugin_api.html#parameterapi"><span class="std std-ref">Parameter API Reference</span></a> docs to
create the wrapper file and finalize the creation of the plugin.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="plugin_api.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">API Reference</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="FrevaCli.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">The Freva command line interface</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, CLINT
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Plugin Developer Guide</a><ul>
<li><a class="reference internal" href="#module-evaluation_system.api.plugin">A Minimal Example</a><ul>
<li><a class="reference internal" href="#evaluation_system.api.plugin.PluginAbstract"><code class="docutils literal notranslate"><span class="pre">PluginAbstract</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#setting-up-your-new-plugin">Setting up your new plugin</a><ul>
<li><a class="reference internal" href="#creating-a-new-repository-from-a-template">Creating a new repository from a template</a></li>
<li><a class="reference internal" href="#installing-dependencies">Installing dependencies</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=930e5b28"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/scripts/furo.js?v=32e29ea5"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    </body>
</html>